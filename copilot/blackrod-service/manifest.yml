name: blackrod-service
type: Load Balanced Web Service

variables:
  DATABASE_HOST: ${DATABASE_HOST}
  DATABASE_NAME: ${DATABASE_NAME}
  DATABASE_USER: ${DATABASE_USER}
  CACHE_LOCATION: ${CACHE_LOCATION}

secrets:
  DATABASE_PASSWORD: ${DATABASE_SECRET_NAME}:password
  SECRET_KEY: blackrod-django:SECRET_KEY


image:
  build: ./Dockerfile
  port: 8000

cpu: 512
memory: 1024
count:
  range:
    min: 1
    max: 4
    spot_from: 2

http:
  path: '/'
  healthcheck:
    path: '/'
    healthy_threshold: 2
    unhealthy_threshold: 2
    interval: 10s
    timeout: 5s

variables:
  ENV: production
  DEBUG: "0"
  DATABASE_HOST: ${DATABASE_HOST}
  DATABASE_NAME: ${DATABASE_NAME}
  DATABASE_USER: ${DATABASE_USER}
  CACHE_LOCATION: ${CACHE_LOCATION}


secrets:
  DATABASE_PASSWORD: ${DATABASE_SECRET_NAME}:password
  SECRET_KEY: blackrod-django:SECRET_KEY

deployment:
  rolling: false
  min_healthy_percent: 100
  max_percent: 200

environments:
  production:
    count: 2
